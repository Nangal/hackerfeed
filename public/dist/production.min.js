angular.module("hack.services",[]).factory("Links",["$http","$interval","Followers",function(a,b,c){var d=[],e=[],f=function(){var b="/api/cache/topStories";return a({method:"GET",url:b}).then(function(a){e.splice(0,e.length),e.push.apply(e,a.data)})},g=function(b){for(var c="http://hn.algolia.com/api/v1/search_by_date?hitsPerPage=500&tagFilters=(story,comment),(",e=[],f=0;f<b.length;f++)e.push("author_"+b[f]);return c+=e.join(",")+")",a({method:"GET",url:c}).then(function(a){angular.forEach(a.data.hits,function(a){null===a.title&&(a.isComment=!0)}),d.splice(0,d.length),d.push.apply(d,a.data.hits)})},h=function(){g(c.following)};return h(),{getTopStories:f,getPersonalStories:g,personalStories:d,topStories:e}}]).factory("Followers",["$http","$window",function(a,b){var c=[],d=function(){var c=b.localStorage.getItem("com.hack");if(c){var d={username:c,following:g()};a({method:"POST",url:"/api/users/updateFollowing",data:d})}},e=function(a){var e=g();e.includes(a)||-1!==c.indexOf(a)||(e+=","+a,b.localStorage.setItem("hfUsers",e),c.push(a)),d()},f=function(a){var e=g();e.includes(a)&&c.indexOf(a)>-1&&(c.splice(c.indexOf(a),1),e=e.split(","),e.splice(e.indexOf(a),1).join(","),b.localStorage.setItem("hfUsers",e)),d()},g=function(){return b.localStorage.getItem("hfUsers")},h=function(){g()||b.localStorage.setItem("hfUsers","pg");var a=g().split(",");c.splice(0,c.length),c.push.apply(c,a)},i=function(){h()};return i(),{following:c,addFollower:e,removeFollower:f,localToArr:h}}]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b}).then(function(a){return a.data})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b}).then(function(a){return a.data})},f=function(){return!!c.localStorage.getItem("com.hack")},g=function(){c.localStorage.removeItem("com.hack")};return{signin:d,signup:e,isAuth:f,signout:g}}]),angular.module("hack.auth",[]).controller("AuthController",["$scope","$window","$location","Auth","Followers",function(a,b,c,d,e){a.user={},a.newUser={},a.loggedIn=d.isAuth(),a.signin=function(){d.signin(a.user).then(function(c){b.localStorage.setItem("com.hack",a.user.username),b.localStorage.setItem("hfUsers",c),e.localToArr(),a.loggedIn=!0,a.user={}})["catch"](function(a){console.error(a)})},a.signup=function(){a.newUser.following=e.following.join(","),d.signup(a.newUser).then(function(c){b.localStorage.setItem("com.hack",a.newUser.username),a.loggedIn=!0,a.newUser={}})["catch"](function(a){console.error(a)})},a.logout=function(){d.signout(),a.loggedIn=!1}}]),angular.module("hack.currentlyFollowing",[]).controller("CurrentlyFollowingController",["$scope","Followers",function(a,b){a.currentlyFollowing=b.following,a.unfollow=function(a){b.removeFollower(a)},a.follow=function(c){b.addFollower(c),a.newFollow=""}}]),angular.module("hack.personal",[]).controller("PersonalController",["$scope","$window","Links","Followers",function(a,b,c,d){a.stories=c.personalStories,a.users=d.following,a.index=30;var e=function(){f()},f=function(){c.getPersonalStories(a.users)};e()}]),angular.module("hack.tabs",[]).controller("TabsController",["$scope","$window",function(a,b){var c=b.location.hash.split("/")[1];c=c?c:"all",a.currentTab=c,a.changeTab=function(b){a.currentTab=b}}]),angular.module("hack.topStories",[]).controller("TopStoriesController",["$scope","$window","Links","Followers",function(a,b,c,d){angular.extend(a,c),a.stories=c.topStories,a.index=30,a.currentlyFollowing=d.following,a.getData=function(){c.getTopStories()},a.addUser=function(a){d.addFollower(a)},a.getData()}]),angular.module("hack",["hack.topStories","hack.personal","hack.currentlyFollowing","hack.services","hack.tabs","hack.auth","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"app/topStories/topStories.html",controller:"TopStoriesController"}).when("/personal",{templateUrl:"app/personal/personal.html",controller:"PersonalController"}).otherwise({redirectTo:"/"})}]).filter("fromNow",function(){return function(a){return humanized_time_span(new Date(a))}}).filter("htmlsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]);